(this.webpackJsonpsaha_web=this.webpackJsonpsaha_web||[]).push([[55],{1058:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return p}));var a=n(39),c=(n(22),n(3)),s=n(20),i=n(61),r=n(6),o=n(2),u=n(359),l=n(4),j=n(1),b=n(21),m=n(7),O=n(9),f=n(0),d=b.a.store_code;function p(e){var t=Object(l.b)(),n=Object(l.c)((function(e){return e.user.profile})),b=Object(l.c)((function(e){return e.app.appTheme})),p=Object(l.c)((function(e){return e.app.chatStatus})),g=Object(o.useState)(j.constants.LOADING),h=Object(r.a)(g,2),x=h[0],v=h[1],k=Object(o.useRef)(null),_=Object(o.useState)(""),y=Object(r.a)(_,2),N=y[0],S=y[1],w=Object(o.useState)(0),C=Object(r.a)(w,2),L=C[0],A=C[1],I=Object(o.useState)([]),T=Object(r.a)(I,2),U=T[0],z=T[1],J=Object(o.useState)(0),R=Object(r.a)(J,2),D=R[0],E=R[1],W=Object(o.useState)([]),G=Object(r.a)(W,2),F=G[0],H=G[1],K=Object(o.useState)(0),P=Object(r.a)(K,2),M=P[0],Z=P[1],q=Object(o.useState)([]),X=Object(r.a)(q,2),B=X[0],Q=X[1],V=Object(o.useState)([]),Y=Object(r.a)(V,2),$=Y[0],ee=Y[1],te=Object(o.useState)({container:"",messages:""}),ne=Object(r.a)(te,2),ae=ne[0],ce=ne[1];function se(){return ie.apply(this,arguments)}function ie(){return(ie=Object(i.a)(Object(a.a)().mark((function e(){var t,n,i,r;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=null,!$.length){e.next=5;break}return e.next=4,le();case 4:t=e.sent;case 5:if(N||$.length){e.next=7;break}return e.abrupt("return");case 7:return S(""),H([]),ee([]),Q([]),(n=Object(c.a)({},ae)).messages="",ce(n),Object(m.a)(new Date),i=JSON.parse(localStorage.getItem("tokenInfo")),r={method:"POST",headers:{"Content-Type":"application/json","customer-token":i?i.token:""},body:JSON.stringify({content:N,link_images:t})},e.abrupt("return",fetch("".concat(j.constants.API_URL,"/customer/").concat(d,"/messages"),r).then((function(e){return e.json()})).then((function(e){if(200===e.code){var t=Object(s.a)(U);t.unshift(e.data),z(t)}})).catch((function(e){return{}})));case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function re(){var e=JSON.parse(localStorage.getItem("tokenInfo")),t={method:"GET",headers:{"Content-Type":"application/json","customer-token":e?e.token:""}};return fetch("".concat(j.constants.API_URL,"/customer/").concat(d,"/messages?page=").concat(M+1),t).then((function(e){return e.json()})).then((function(e){if(200===e.code){v(j.constants.SUCCESS),Z(e.data.current_page),0===L&&A(e.data.last_page);var t=[].concat(Object(s.a)(U),Object(s.a)(e.data.data));z(function(e){var t=Object(s.a)(e),n=e.map((function(e){return e.id}));return t.map((function(e,t){return Object(c.a)(Object(c.a)({},e),{},{is_duplicate:t!==n.lastIndexOf(e.id)})}))}(t))}else v(j.constants.FAILURE)})).catch((function(e){return{}}))}function oe(){var e=p?"":"active";t(O.a.setChatStatus(e)),E(0)}function ue(e){var t={width:e.target.naturalWidth,height:e.target.naturalHeight},n=[].concat(Object(s.a)(F),[t]);H(n)}function le(){return je.apply(this,arguments)}function je(){return(je=Object(i.a)(Object(a.a)().mark((function e(){var t,n,c,i;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(s.a)(F),n=0;case 2:if(!(n<$.length)){e.next=13;break}return t[n].size=$[n].size,(c=new FormData).append("image",$[n]),e.next=8,Object(m.q)(c);case 8:i=e.sent,t[n].link_images=i;case 10:n++,e.next=2;break;case 13:return H(t),e.abrupt("return",JSON.stringify(t));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var be=!1,me=0;return Object(o.useEffect)((function(e){if(1!=be){if(be=!0,!n.id)return;if(x===j.constants.LOADING)if(re(),navigator.userAgent.includes("Zalo")||document.referrer.includes("zalo.com")||"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.11 (KHTML, like Gecko) Chrome/23.0.1271.95 Safari/537.11 _zbot"==navigator.userAgent)console.log("Trang web \u0111\u01b0\u1ee3c m\u1edf t\u1eeb \u1ee9ng d\u1ee5ng Zalo.");else Object(u.a)("https://main.doapp.vn:6441").on("chat:message_from_user:".concat(n.id),(function(e){setTimeout((function(){e.id!=me&&(me=e.id,t(O.a.setChatStatus("active")),E(0),z((function(t){return[e].concat(Object(s.a)(t))})),E(D+1))}),100)}));if(function(){var e=Object(c.a)({},ae);$.length?e.messages="with-image":e.messages="",ce(e)}(),H([]),$.length){var a;return a=$.map((function(e){return URL.createObjectURL(e)})),Q(a),function(){return URL.revokeObjectURL(a)}}Q([])}}),[]),n.id?Object(f.jsxs)("div",{className:"chat",children:[Object(f.jsx)("img",{className:"fa-headset",src:"/img/U0LwC5d.gif",onClick:oe,alt:""}),Object(f.jsxs)("div",{className:"messages-container ".concat(p),children:[Object(f.jsxs)("div",{onClick:oe,className:"title",style:{cursor:"pointer",background:b.color_main_1,display:"flex",justifyContent:"space-between"},children:[Object(f.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[Object(f.jsx)("i",{class:"far fa-comment-dots"}),"\xa0\xa0 H\u1ed7 tr\u1ee3 kh\xe1ch h\xe0ng\xa0",D>0&&Object(f.jsx)("span",{style:{fontSize:"14px"},children:"(".concat(D,")")})]}),Object(f.jsx)("i",{style:{fontSize:"12px"},className:"fas fa-window-minimize"})]}),Object(f.jsx)("div",{className:"messages ".concat(ae.messages),children:Object(f.jsxs)("div",{className:"column",children:[function(e){return e.map((function(e,t){return!e.is_duplicate&&Object(f.jsx)("div",{className:e.is_user?"message-container":"message-container user",children:Object(f.jsxs)("div",{style:{background:e.is_user?"white":b.color_main_1,color:e.is_user?"black":"white"},className:e.is_user?"message user":"message",children:[Object(f.jsx)("div",{className:"content",children:e.content}),e.link_images&&Object(m.m)(e.link_images)&&Object(f.jsx)("div",{className:"message-images",children:Array.isArray(JSON.parse(e.link_images))&&JSON.parse(e.link_images).map((function(e,t){return e&&Object(f.jsx)("div",{className:"image",children:Object(f.jsx)("div",{className:"img-container",children:Object(f.jsx)("img",{src:e.link_images,alt:""})})},t)}))}),Object(f.jsx)("span",{children:e.created_at.slice(11,16)})]},t)},t)}))}(U),L>M&&Object(f.jsx)("button",{onClick:re,children:"Xem tin nh\u1eafn c\u0169 h\u01a1n"})]})}),Object(f.jsxs)("div",{className:"message-input",style:{justifyContent:"space-between"},onKeyDown:function(e){"Enter"===e.key&&se()},children:[Object(f.jsx)("input",{value:N,onChange:function(e){return S(e.target.value)},placeholder:"Nh\u1eadp tin nh\u1eafn...",type:"text"}),Object(f.jsx)("button",{onClick:se,children:Object(f.jsx)("i",{style:{color:b.color_main_1},className:"fas fa-paper-plane"})}),Object(f.jsx)("button",{onClick:function(){k.current.click()},children:Object(f.jsx)("i",{style:{color:b.color_main_1},className:"fas fa-camera"})})]}),Object(f.jsx)("div",{className:"images-upload",children:B.map((function(e,t){return Object(f.jsxs)("div",{className:"previewed-image",children:[Object(f.jsx)("button",{onClick:function(){return function(e){var t=Object(s.a)($);t.splice(e,1),ee(t)}(t)},children:Object(f.jsx)("i",{className:"fas fa-times"})}),Object(f.jsx)("div",{className:"image",children:Object(f.jsx)("div",{className:"img-container",children:Object(f.jsx)("img",{src:e,alt:"",onLoad:ue})})})]},t)}))})]}),Object(f.jsx)("input",{type:"file",ref:k,multiple:!0,onChange:function(e){if(e.target.files){var t=Array.prototype.slice.call(e.target.files);ee(t)}},accept:"image/jpeg, image/jpg, image/png",style:{display:"none"}})]}):Object(f.jsx)(f.Fragment,{})}}}]);